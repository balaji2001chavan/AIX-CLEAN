<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <title>Boss AIX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    .app {
      max-width: 900px;
      margin: auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 14px;
    }
    h2 {
      margin: 0 0 10px;
      text-align: center;
    }
    #chat {
      flex: 1;
      overflow-y: auto;
      background: #020617;
      border-radius: 10px;
      padding: 12px;
      border: 1px solid #1e293b;
    }
    .msg {
      margin-bottom: 10px;
      line-height: 1.5;
      white-space: pre-wrap;
    }
    .user { color: #38bdf8; }
    .boss { color: #a7f3d0; }

    .input-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    input {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: none;
      outline: none;
      font-size: 16px;
    }
    button {
      padding: 12px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      background: #22c55e;
      color: #022c22;
    }
    button:disabled {
      background: #475569;
      color: #cbd5f5;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
<div class="app">
  <h2>ü§ñ Boss AIX</h2>

  <div id="chat"></div>

  <div class="input-row">
    <input id="input"
           placeholder="Boss AIX ‡§≤‡§æ ‡§¨‡•ã‡§≤‡§æ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§≤‡§ø‡§π‡§æ..."
           onkeydown="if(event.key==='Enter'){sendText();}" />
    <button onclick="sendText()">Send</button>
    <button onclick="startVoice()">üé§</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */

// üî¥ IMPORTANT: ‡§§‡•Å‡§ù‡§æ Render BACKEND URL ‡§á‡§•‡•á ‡§Ö‡§∏‡§æ‡§Ø‡§≤‡§æ‡§ö ‡§π‡§µ‡§æ
const BACKEND_URL =
  "https://boss-aix-backend.onrender.com/api/boss/command";

/* ============== UI HELPERS ================ */

const chat = document.getElementById("chat");
const input = document.getElementById("input");

function addMsg(text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerHTML = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ============== VOICE INPUT =============== */

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.lang = "mr-IN"; // hi-IN / en-US ‡§µ‡§æ‡§™‡§∞‡•Ç ‡§∂‡§ï‡§§‡•ã‡§∏
recognition.continuous = false;

function startVoice() {
  recognition.start();
}

recognition.onresult = (event) => {
  const text = event.results[0][0].transcript;
  input.value = text;
  sendText();
};

/* ============== VOICE OUTPUT ============== */

function speakText(text) {
  if (!window.speechSynthesis) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "mr-IN";
  speechSynthesis.speak(utter);
}

/* ============== MAIN CHAT ================= */

async function sendText() {
  const text = input.value.trim();
  if (!text) return;

  addMsg("<b>You:</b> " + text, "user");
  input.value = "";

  try {
    const res = await fetch(BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await res.json();

    // ‚úÖ Normal reply
    if (data.reply) {
      addMsg("<b>Boss AIX:</b> " + data.reply, "boss");
      speakText(data.reply);
    }

    // ‚úÖ ACTION PLAN MODE
    if (data.askApproval && data.plan) {
      addMsg("<b>üß† Action Plan:</b>", "boss");
      data.plan.forEach(step => {
        addMsg("‚Ä¢ " + step, "boss");
      });
      addMsg("<b>Approve?</b> YES / NO", "boss");
      speakText("‡§Æ‡•Ä ‡§è‡§ï ‡§™‡•ç‡§≤‡•Ö‡§® ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡•á‡§≤‡§æ ‡§Ü‡§π‡•á. ‡§Æ‡§Ç‡§ú‡•Å‡§∞‡•Ä ‡§¶‡•ç‡§Ø‡§æ‡§≤ ‡§ï‡§æ?");
    }

  } catch (e) {
    addMsg("<b>Boss AIX:</b> ‚ùå Backend reachable ‡§®‡§æ‡§π‡•Ä", "boss");
  }
}

/* ============== WELCOME =================== */
addMsg("<b>Boss AIX:</b> ‡§Æ‡•Ä ‡§§‡§Ø‡§æ‡§∞ ‡§Ü‡§π‡•á. ‡§Ü‡§ú ‡§ï‡§æ‡§Ø ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•Ç?", "boss");
</script>
</body>
</html>
