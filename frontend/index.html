<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <title>Boss AIX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
      font-family: system-ui, Arial;
    }
    .app {
      max-width: 900px;
      margin: auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px;
    }
    h2 {
      margin: 6px 0;
      text-align: center;
    }
    #chat {
      flex: 1;
      background: #020617;
      border-radius: 8px;
      padding: 10px;
      overflow-y: auto;
    }
    .msg {
      margin-bottom: 10px;
      line-height: 1.4;
    }
    .user { color: #38bdf8; }
    .boss { color: #a7f3d0; }

    .controls {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    input {
      flex: 1;
      padding: 12px;
      border-radius: 6px;
      border: none;
      outline: none;
    }
    button {
      padding: 12px 14px;
      border-radius: 6px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      background: #22c55e;
    }
    button.mic {
      background: #6366f1;
    }
  </style>
</head>

<body>
  <div class="app">
    <h2>ðŸ¤– Boss AIX</h2>

    <div id="chat"></div>

    <div class="controls">
      <input id="input" placeholder="Boss AIX à¤²à¤¾ à¤¬à¥‹à¤²à¤¾ à¤•à¤¿à¤‚à¤µà¤¾ à¤²à¤¿à¤¹à¤¾..." />
      <button onclick="send()">Send</button>
      <button class="mic" onclick="startVoice()">ðŸŽ¤</button>
    </div>
  </div>

<script>
/* âœ… EXACT BACKEND URL */
const BACKEND_URL =
  "https://boss-aix-backend.onrender.com/api/boss/command";

const chat = document.getElementById("chat");
const input = document.getElementById("input");

/* Utility */
function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerHTML = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* Speak */
function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "mr-IN";
  speechSynthesis.speak(u);
}

/* Send text */
async function send() {
  const text = input.value.trim();
  if (!text) return;

  addMessage("<b>You:</b> " + text, "user");
  input.value = "";

  try {
    console.log("Calling backend:", BACKEND_URL);

    const res = await fetch(BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    if (!res.ok) throw new Error("HTTP " + res.status);

    const data = await res.json();

    if (data.reply) {
      addMessage("<b>Boss AIX:</b> " + data.reply, "boss");
      speak(data.reply);
    }
  } catch (err) {
    console.error("FETCH ERROR:", err);
    addMessage("<b>Boss AIX:</b> âŒ Backend reachable à¤¨à¤¾à¤¹à¥€", "boss");
  }
}

/* Enter key support */
input.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});

/* Voice input */
const SpeechRec =
  window.SpeechRecognition || window.webkitSpeechRecognition;

let recog;
if (SpeechRec) {
  recog = new SpeechRec();
  recog.lang = "mr-IN";
  recog.onresult = e => {
    input.value = e.results[0][0].transcript;
    send();
  };
}

function startVoice() {
  if (recog) recog.start();
}

/* Welcome */
addMessage(
  "<b>Boss AIX:</b> à¤®à¥€ à¤¤à¤¯à¤¾à¤° à¤†à¤¹à¥‡. à¤†à¤œ à¤•à¤¾à¤¯ à¤•à¤¾à¤® à¤•à¤°à¥‚?",
  "boss"
);
</script>
</body>
</html>
