<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BOSS AIX Voice</title>
</head>
<body>

<h2>ğŸ¤ Boss AIX â€“ Smart Voice</h2>
<button onclick="startAIX()">ğŸ™ï¸ à¤¬à¥‹à¤²à¤¾</button>

<pre id="out"></pre>

<script>
function startAIX() {
  // ğŸ‘‰ USER click = speech allowed
  const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

  rec.interimResults = false;
  rec.onstart = () => console.log("ğŸ§ Listening...");

  rec.onresult = (e) => {
    const text = e.results[0][0].transcript;
    const lang = detectLang(text);

    document.getElementById("out").textContent =
      "ğŸ§ à¤à¤•à¤²à¥‡: " + text + "\nâ³ Processing...";

    fetch("http://localhost:5000/api/voice", {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ text })
    })
    .then(r=>r.json())
    .then(data=>{
      const reply = data.action?.message || "à¤®à¥€ à¤²à¤—à¥‡à¤š à¤ªà¤¾à¤¹à¤¤à¥‹";
      document.getElementById("out").textContent =
        JSON.stringify(data, null, 2);

      speak(reply, lang);
    });
  };

  rec.lang = "mr-IN"; // default
  rec.start();
}

// âœ… language detector (simple but working)
function detectLang(text){
  if (/[à¤…-à¤¹]/.test(text)) return "mr-IN";
  if (/[à¤€-à¥¿]/.test(text)) return "hi-IN";
  return "en-IN";
}

// âœ… SMART + CUTE VOICE
function speak(text, lang){
  speechSynthesis.cancel(); // stop old voice

  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;

  // Boss but cute ğŸ˜„
  u.rate = 0.9;
  u.pitch = 1.1;
  u.volume = 1;

  // Try to pick sweet voice
  const voices = speechSynthesis.getVoices();
  const preferred = voices.find(v => v.lang === lang && v.name.toLowerCase().includes("female"));
  if (preferred) u.voice = preferred;

  speechSynthesis.speak(u);
}
</script>

</body>
</html>